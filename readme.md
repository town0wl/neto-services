1.
|                                   | Kong                                                                                                                           | Tyk.io                                                                                        | Apigee                                                                                        | Express API Gateway                                                                                  | Amazon AWS API Gateway                                                                                    | Azure API Gateway             |
| --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- | ----------------------------- |
| Описание                          | The most popular open-source cloud-native API gateway built on top of a lightweight proxy.                                     | built on GoLang, which, as a system language, is designed for high throughput and parallelism | Apigee was designed to turn legacy monoliths into APIs that can be consumed by third parties. | Design philosophy is to keep it minimal and declarative.                                             | Amazon cloud service                                                                                      | Microsoft Azure cloud service |
| Особенности                       | doesn’t have a lot of transformation layer (mostly HTTP based transformation, no SOAP or to XML)                               |                                                                                               | Supports end to end integrated billing                                                        | If you are building a lot of your core infrastructure on Node.js and familar with express middleware | If you already are using AWS Lambda or EC2, you can deploy AWS API gateway in the same data center region | For Azure Cloud backend.      |
| Администрирование                 | The administration and management task can be performed via CLI or curl commands to a REST API                                 | Tyk has both a REST API and a web dashboard to do administrative tasks                        | The management portal is built on top of Drupal.                                              |                                                                                                      | AWS API Gateway is fully managed and can be deployed with a few clicks in the AWS portal.                 |                               |
| Лицензия                          | Apache 2.0<br>certain features like the Admin UI, Security, and developer portal are available only with an enterprise license | MPL                                                                                           | proprietary                                                                                   | Apache 2.0                                                                                           | proprietary                                                                                               | proprietary                   |
| Базовые компоненты                | Nginx, Lua                                                                                                                     | GoLang                                                                                        | Java                                                                                          | Node.js Express                                                                                      | Amazon AWS cloud                                                                                          | Microsoft Azure cloud         |
| Необходимое хранилище данных      | Cassandra/Postgres                                                                                                             | Redis                                                                                         | Cassandra, Zookeeper and Postgres                                                             | Redis                                                                                                | Cloud vendor PaaS                                                                                         | Cloud vendor PaaS             |
| Сообщество                        | Большое                                                                                                                        | Среднее                                                                                       | Мало                                                                                          | Мало                                                                                                 | Мало                                                                                                      | Мало                          |
| Дополнения и расширения           | +                                                                                                                              | +                                                                                             | \-                                                                                            | +                                                                                                    | \-                                                                                                        | \-                            |
| Собственное/облачное              | +/+                                                                                                                            | +/Tyk.io,Heroku, AWS                                                                          | Apigee Edge requires running 9-nodes minimum on-premises/Google Cloud                         | +/+                                                                                                  | \-/+                                                                                                      | \-/+                          |
| Маршрутизация запросов            | +                                                                                                                              | +                                                                                             | +                                                                                             | +                                                                                                    | +                                                                                                         | +                             |
| Аутентификация                    | +                                                                                                                              | +                                                                                             | +                                                                                             | +                                                                                                    | +                                                                                                         | +                             |
| Терминация HTTPS                  | +                                                                                                                              | +                                                                                             | +                                                                                             | +                                                                                                    | +                                                                                                         | +                             |
| Квотирование и лимиты для трафика | +                                                                                                                              | +                                                                                             | +                                                                                             | +                                                                                                    | +                                                                                                         | +                             |

Еще:  
Google Cloud Endpoints: Endpoints is a lighter version of Apigee by Google Cloud. For Google Cloud backend.  
KrakenD: Ultra-high performance open-source API Gateway. KrakenD claims to be faster than Kong and Tyk.  
Goku: Golang-based microservice gateway that enables high-performance dynamic routing, service orchestration, multi-tenancy management, API access control, etc.  
Gloo: next-generation fully featured API gateway and Ingress Controller for cloud-native environments. With Developer portal, WAF, Data loss prevention. Envoy Proxy  
Fusio: It is not limited to proxy requests to another API. It provides a simple and intuitive backend to control and manage your API.  
WSO2: full lifecycle API Management solution. It comprises a cloud-native API gateway and provides a Kubernetes operator to convert raw microservices into managed APIs easily.

В общем случае выбираем **Kong** как наиболее распространенный, функциональный, со свободной лицензией Apache 2.0 и достаточно производительный (см. https://www.krakend.io/docs/benchmarks/api-gateway-benchmark/).  
Если обслуживаемая инфраструктура с несложной и достаточно статичной схемой маршрутизации, можно использовать Nginx.  
Если инфраструктура в облаке и не требуется специфичных функций от API Gateway, можно использовать решение от облачного провайдера.  
Если критична максимальная производительность, рассмотреть KrakenD.  
Если требуется встроенный биллинг, рассмотреть решения с его поддержкой.



2.
|                                                                   | RabbitMQ                                                                                                                             | Apache Kafka                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Redis                                                                                                   | ZeroMQ                                                                                                                                                                              |
| ----------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Особенности                                                       | Поддерживает гибкую маршрутизацию сообщений с использованием ключей маршрутизации (Routing Keys) и набора разных отдельных очередей. | Сообщения сохраняются в той же последовательности, в которой поступили. Подписчики сами отправляют запросы к брокеру о новых сообщениях и указывают, что им нужно прочитать. Сообщения после прочтения не удаляются. Kafka не отслеживает, получил ли подписчик сообщение, он просто хранит его в течение установленного времени. Для организации систем со сложной топологией применяют темы — разделы для категоризации различных сообщений по назначению. Для маршрутизации сообщений могут применяться Routing Keys. | Временное хранилище данных в памяти. Идеально подходит для обработки данных в режиме реального времени. | Распределенная система максимально быстрой доставки сообщений. Представляет собой фреймворк, который требует самостоятельного создания сценариев для реализации необходимой логики. |
| Лицензия                                                          | MPL-1.1                                                                                                                              | Apache-2.0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | BSD-3-Clause                                                                                            | LGPL-3.0                                                                                                                                                                            |
| Протоколы                                                         | AMQP<br>MQTT<br>STOMP                                                                                                                | binary protocol over TCP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | RESP                                                                                                    | ZMTP                                                                                                                                                                                |
| Клиенсткое ПО                                                     | Python, Java, .NET, PHP, Ruby, JavaScript, Go, Swift and more                                                                        | Python, Java, C/C++, Clojure, .NET, PHP, Ruby, JavaScript, Go, Swift and more                                                                                                                                                                                                                                                                                                                                                                                                                                            | Node.js, .NET, Python, Java, PHP, C, Ruby, Drupal                                                       | C/C++, C#, Go, Java, Node.js, Perl, Python, Ruby, Rust, PHP, Swift, and more                                                                                                        |
| Производительность (ориентировочный порядок, сообщений в секунду) | 50тыс                                                                                                                                | миллионы                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | до миллиона                                                                                             | миллионы                                                                                                                                                                            |
| Сообщество                                                        | Большое                                                                                                                              | Большое                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Огромное                                                                                                | Среднее                                                                                                                                                                             |
| Тип хранения                                                      | Постоянное, временное                                                                                                                | Постоянное                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Временное                                                                                               | Временное                                                                                                                                                                           |
| Тип доставки                                                      | one-to-one, one-to-many (Push: Point-to-Point, Publish/Subscribe)                                                                    | Pull with 'long polling' improvment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | one-to-one, one-to-many                                                                                 | Synchronous Request/Response<br>Asynchronous Request/Response<br>Publish/Subscribe<br>Push/Pull<br>Exclusive Pair                                                                   |

Больше: https://ultimate-comparisons.github.io/ultimate-message-broker-comparison/  
В итоге выбираем **Apache Kafka** как решение с выдающейся производительностью, хранением данных на диске, которое предпочитают и используют множество крупных компаний (More than 80% of all Fortune 100 companies use Kafka.). Любые форматы данных, поддерживаемые клиентским ПО. Модуль Authorizer позволяет ограничить доступ к ресурсам по ACL (требуется ZooKeeper).



3.
```
root@vagrant:/home/vagrant/services/11-microservices-02-principles# curl -X POST -H 'Content-Type: application/json' -d '{"login":"bob", "password":"qwe123"}' http://127.0.0.1/v1/token
11-microservices-02-principles-security-1       | 172.28.0.5 - - [22/Apr/2022 21:10:44] "POST /v1/token HTTP/1.0" 200 -
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJib2IifQ.hiMVLmssoTsy1MqbmIoviDeFPvo-nCd92d4UFiN2O2Iroot@vagrant:/home/vagrant/services/11-microservices-02-principles#
root@vagrant:/home/vagrant/services/11-microservices-02-principles#
root@vagrant:/home/vagrant/services/11-microservices-02-principles# curl -X POST -H 'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJib2IifQ.hiMVLmssoTsy1MqbmIoviDeFPvo-nCd92d4UFiN2O2I' -H 'Content-Type: octet/stream' --data-binary @mini.jpg http://localhost/v1/upload
11-microservices-02-principles-security-1       | 172.28.0.5 - - [22/Apr/2022 21:11:23] "GET /v1/token/validation HTTP/1.0" 200 -
11-microservices-02-principles-uploader-1       | Detected file type: image/jpeg
11-microservices-02-principles-uploader-1       | Saved file: 58762a40-88f5-44bb-90c8-96beb27c0d6f.jpg
{"filename":"58762a40-88f5-44bb-90c8-96beb27c0d6f.jpg"}
root@vagrant:/home/vagrant/services/11-microservices-02-principles#
root@vagrant:/home/vagrant/services/11-microservices-02-principles# curl -I -X GET -H 'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJib2IifQ.hiMVLmssoTsy1MqbmIoviDeFPvo-nCd92d4UFiN2
O2I' http://localhost/v1/user/58762a40-88f5-44bb-90c8-96beb27c0d6f.jpg
11-microservices-02-principles-security-1       | 172.28.0.5 - - [22/Apr/2022 21:12:13] "GET /v1/token/validation HTTP/1.0" 200 -
HTTP/1.1 200 OK
Server: nginx/1.21.6
Date: Fri, 22 Apr 2022 21:12:13 GMT
Content-Type: binary/octet-stream
Content-Length: 650
Connection: keep-alive
Accept-Ranges: bytes
Content-Security-Policy: block-all-mixed-content
ETag: "e39366ca059422bd62f44044b2aca3f1"
Last-Modified: Fri, 22 Apr 2022 21:11:23 GMT
No-Gzip-Compression: true
Strict-Transport-Security: max-age=31536000; includeSubDomains
Vary: Origin
Vary: Accept-Encoding
X-Amz-Request-Id: 16E8544855D32730
X-Content-Type-Options: nosniff
X-Xss-Protection: 1; mode=block

root@vagrant:/home/vagrant/services/11-microservices-02-principles# curl -I -X GET -H 'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJ' http://localhost/v1/user/58762a40-88f5-44bb-90c8-96beb27c0d6f.jpg
11-microservices-02-principles-security-1       | 172.28.0.5 - - [22/Apr/2022 21:13:36] "GET /v1/token/validation HTTP/1.0" 401 -
HTTP/1.1 401 Unauthorized
Server: nginx/1.21.6
Date: Fri, 22 Apr 2022 21:13:36 GMT
Content-Type: text/html
Content-Length: 179
Connection: keep-alive
```
